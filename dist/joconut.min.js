/*! Joconut - v0.1.1 - 2012-06-03
* https://github.com/vdemedes/joconut
* Copyright (c) 2012 Vadim Demedes; Licensed MIT */
var fn;window._History=function(){function a(){}return a.listeners={},a.states={},a.loaded=!1,a.init=function(){var a=this;return window.history.replaceState?(window.history.replaceState({url:location.pathname},document.title,location.pathname),this.states[location.pathname]={state:{url:location.pathname},title:document.title},window.onpopstate=function(){return a.loaded?a.emit("change",a.states[location.pathname]):a.loaded=!0}):(this.states[location.hash]={state:{url:location.pathname},title:document.title},window.onhashchange=function(){return a.emit("change",a.states[location.hash])})},a.emit=function(a,b){var c,d,e,f,g;f=this.listeners[a],g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(c(b));return g},a.on=function(a,b){return this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(b)},a.push=function(a,b,c){return b&&(document.title=b),this.states[history.pushState?c:"#"+c]={state:a,title:b},history.pushState?history.pushState(a,b,c):location.hash=c},a}(),_History.init(),fn=function(a){var b,c,d,e,f;return d=new RegExp("^("+location.origin.replace(/\:/g,"\\:").replace(/\//g,"\\/")+"|\\.|\\/|[A-Z0-9_])","i"),a.expr[":"].local=function(a){var b,c;return c=!1,b=a.attributes.href.value,d.test(b)&&(c=!0),c},b=function(b,c){var d,g,h,i;a("body").html(/<body[^>]*>((.|[\n\r])*)<\/body>/im.exec(b)[1]),document.title=/<title>((.|\n\r])*)<\/title>/im.exec(b)[1],d=void 0;for(;;){i=/<script\b[^>]*><\/script>/gm.exec(b);if(!i)break;h=/src\=.?([A-Za-z0-9-_.\/]+).?/.exec(i[0]);if(!h)break;h=h[1],-1===e.indexOf(h)&&(e.push(h),d||(d=a("head")),d.append(i[0])),b=b.replace(i[0],"")}for(;;){i=/<link\b[^>]*\/?>/gm.exec(b);if(!i)break;if(/rel\=.?stylesheet.?/.test(i[0])){g=/href\=.?([A-Za-z0-9-_.\/]+).?/.exec(i[0]);if(!g)break;g=g[1],-1===f.indexOf(g)&&(f.push(g),d||(d=a("head")),d.append(i[0]))}b=b.replace(i[0],"")}return setTimeout(function(){a.joconut();if(c)return c()},50)},c=function(b,c){return a.ajax({url:b.url,type:"GET",success:function(a){return c(!1,a)}})},_History.on("change",function(a){return c({url:a.state.url},function(a,c){return b(c)})}),e=[],a("script").each(function(){return e.push(a(this).attr("src"))}),f=[],a("link").each(function(){return f.push(a(this).attr("href"))}),a.joconut=function(){return a("a:local").each(function(){var d;return d=a(this),d.click(function(a){var e;return e=d.attr("href"),a.preventDefault(),c({url:e},function(a,c){return b(c,function(){return _History.push({url:e},!1,e)})})})})},a(function(){return a.joconut()})},fn(jQuery);